{"name":"Saga","body":"![Screenshot of example report](http://i40.tinypic.com/1s1c20.jpg)\r\n\r\nWhat? Another coverage tool?\r\n============================\r\n\r\nIndeed. I've been using [JSCoverage](http://siliconforks.com/jscoverage/) a lot - and it proved to be a pain to use in\r\na Continuous Integration environment. In desperation, I wrote the\r\n[jscoverage-maven-plugin](https://github.com/timurstrekalov/jscoverage-maven-plugin), a\r\n[Maven](http://maven.apache.org/) wrapper around JSCoverage, which did the job, except for some huge drawbacks:\r\n\r\n1. It directly depended on JSCoverage.\r\n2. It only generated the statements/executed/coverage report, even though JSCoverage itself made it possible to see\r\n    a line-by-line coverage report. Of course, I simply used jscoverage-server when I needed to see the lines I missed\r\n    when writing tests, but, again, it's a hassle.\r\n3. The user had to provide the path to the jscoverage binary, which most people would frown upon -\r\n    it's just too much of a hassle. Of course, I could ship the binaries for all platforms together with the plugin\r\n    and decide which one to use during runtime, but this just sounds sketchy every time I think about it...\r\n4. It wasn't deployed to any Maven repository, so everyone would have to build it themselves.\r\n\r\nHaving JSCoverage as a dependency proved to be painful as well:\r\n\r\n1. It's native - that alone makes it a pain when it comes to CI.\r\n2. JSCoverage, as most (all?) tools only provide the total coverage report, whereas I often find myself wishing I could\r\n    also get a coverage report for every test run.\r\n3. It doesn't seem to be under any active development\r\n\r\nThe good things about Saga\r\n==========================\r\n\r\n1. It's Java. Wait, scratch that, that's not necessarily a good thing. However, it's written in Java for a reason: the\r\n    idea was that it should be extremely simple to integrate it with Maven and any other build tool. Another reason is\r\n    the fact that it heavily relies on [HtmlUnit](http://htmlunit.sourceforge.net/) and its internals for running\r\n    tests and instrumentation.\r\n2. It can generate both total coverage and per-test reports. The good thing about it is that you get more accurate\r\n    results - unit tests are designed to cover specific units. If your total coverage report shows you high coverage\r\n    for a unit, that does not necessarily mean that you've covered the unit that much. Actually, it doesn't mean you've\r\n    covered it at all - it just means that some test might have invoked some parts of that unit as a side effect.\r\n3. It has a pretty coverage report, especially after implementing the suggestions of\r\n    [Marat Dyatko](https://github.com/vectart) :)\r\n4. It tries to make the most of your processor power by running tests and generating coverage in parallel by default.\r\n5. It can generate coverage even for inline scripts.\r\n6. It's already in [Maven Central](http://repo1.maven.org/) and constantly synced, so adding it to your build cycle\r\n    is pretty straightforward.\r\n7. It just works. There's very little configuration, and I'd like to think that the defaults are sensible enough.\r\n8. It's being actively developed, it's open, it's completely free.\r\n\r\nMaven plugin usage\r\n==================\r\n\r\nAdd the following piece of code:\r\n\r\n    <plugin>\r\n        <groupId>com.github.timurstrekalov</groupId>\r\n        <artifactId>saga-maven-plugin</artifactId>\r\n        <version>1.0.6</version>\r\n        <executions>\r\n            <execution>\r\n                <phase>verify</phase>\r\n                <goals>\r\n                    <goal>coverage</goal>\r\n                </goals>\r\n            </execution>\r\n        </executions>\r\n        <configuration>\r\n            <baseDir>${testsBaseDir}</baseDir>\r\n            <includes>\r\n                **/set1/*-TestRunner.html,\r\n                **/set2/*-TestRunner.html\r\n            </includes>\r\n            <outputDir>${project.build.directory}/coverage</outputDir>\r\n        </configuration>\r\n    </plugin>\r\n\r\nAnd that's it. Wait, you also have to do\r\n\r\n    mvn verify\r\n\r\nOf course, there are some more configuration options, if you feel like it:\r\n\r\n<table>\r\n    <thead>\r\n        <tr>\r\n            <th>Parameter name</th>\r\n            <th>Description</th>\r\n            <th>Default value</th>\r\n        </tr>\r\n    </thead>\r\n    <tbody>\r\n        <tr>\r\n            <td><strong>baseDir</strong></td>\r\n            <td>The base directory for the test search</td>\r\n            <td>none</td>\r\n        </tr>\r\n        <tr>\r\n            <td><strong>includes</strong></td>\r\n            <td>\r\n                A comma-separated list of\r\n                <a href=\"http://ant.apache.org/manual/dirtasks.html#patterns\">Ant-style patterns</a> to include in\r\n                the search for test runners\r\n            </td>\r\n            <td>none</td>\r\n        </tr>\r\n        <tr>\r\n            <td>excludes</td>\r\n            <td>\r\n                A comma-separated list of\r\n                <a href=\"http://ant.apache.org/manual/dirtasks.html#patterns\">Ant-style patterns</a> to exclude from\r\n                the search for test runners\r\n            </td>\r\n            <td>none</td>\r\n        </tr>\r\n        <tr>\r\n            <td><strong>outputDir</strong></td>\r\n            <td>The output directory for coverage reports</td>\r\n            <td>none</td>\r\n        </tr>\r\n        <tr>\r\n            <td>outputInstrumentedFiles</td>\r\n            <td>Whether to output instrumented files. Will be written to ${outputDir}/instrumented</td>\r\n            <td>false</td>\r\n        </tr>\r\n        <tr>\r\n            <td>noInstrumentPatterns</td>\r\n            <td>A list of regular expressions to match source file paths to be excluded from instrumentation</td>\r\n            <td>none</td>\r\n        </tr>\r\n        <tr>\r\n            <td>cacheInstrumentedCode</td>\r\n            <td>\r\n                Whether to cache instrumented source code. It's entirely possible that two tests might load some of the\r\n                same resources - this would prevent them from being instrumented every time, but rather cache them for\r\n                the whole coverage run.\r\n            </td>\r\n            <td>true</td>\r\n        </tr>\r\n        <tr>\r\n            <td>outputStrategy</td>\r\n            <td>One of TOTAL, PER_TEST or BOTH. Pretty self-explanatory.</td>\r\n            <td>TOTAL</td>\r\n        </tr>\r\n        <tr>\r\n            <td>threadCount</td>\r\n            <td>The maximum number of threads to use.</td>\r\n            <td>Runtime.getRuntime().availableProcessors()</td>\r\n        </tr>\r\n    </tbody>\r\n</table>\r\n\r\nTested on Maven version 2.2.1 & 3.x.x\r\n\r\nUsing no-instrument patterns\r\n----------------------------\r\n\r\nIt might be a little confusing, but the no-instrument patterns are actually [regular expressions](http://www.regular-expressions.info/) which *full script paths* are matched against. \r\nSo, if you had a test which loaded a script like this\r\n\r\n    <script src=\"someScript.js\"></script>\r\n    \r\nIf you wanted to exclude \"someScript.js\" from instrumentation, you would have to specify a pattern as follows:\r\n\r\n    <!-- ... -->\r\n    \r\n    <noInstrumentPatterns>\r\n        <pattern>.+/someScript\\.js</pattern>\r\n    </noInstrumentPatterns>\r\n    \r\n    <!-- ... -->\r\n    \r\nThat is, if you don't care about which file named \"someScript.js\" gets excluded. If you do (say, you have multiple files named \"someScript.js\"), you would have to provide more specific patterns, such as\r\n\r\n    <!-- ... -->\r\n    \r\n    <noInstrumentPatterns>\r\n        <pattern>.+/onlyExcludeThisOne/someScript\\.js</pattern>\r\n    </noInstrumentPatterns>\r\n    \r\n    <!-- ... -->\r\n    \r\nAnd so forth.\r\n\r\nOther build tools\r\n-----------------\r\n\r\nUsing some other build tool? [Raise a ticket](https://github.com/timurstrekalov/saga/issues/new)!\r\n\r\nCommand-line tool\r\n=================\r\n\r\nThere's also a command-line utility for those not using Maven. It has pretty much the same configuration options and works just as well.\r\n\r\n    usage: java -jar saga-cli-<version>-jar-with-dependencies.jar -b <arg> [-e <arg>] [-f] [-h] -i <arg> [-n\r\n       <arg>] -o <arg> [-s <arg>] [-t <arg>]\r\n    \r\n     -b,--base-dir <arg>                Base directory for test search\r\n     -e,--exclude <arg>                 Comma-separated list of Ant-style\r\n                                        paths to the tests to exclude from run\r\n     -f,--output-instrumented-files     Whether to output instrumented files\r\n                                        (default is false)\r\n     -h,--help                          Print this message\r\n     -i,--include <arg>                 Comma-separated list of Ant-style\r\n                                        paths to the tests to run\r\n     -n,--no-instrument-pattern <arg>   Regular expression patterns to match\r\n                                        classes to exclude from\r\n                                        instrumentation\r\n     -o,--output-dir <arg>              The output directory for coverage\r\n                                        reports\r\n     -s,--output-strategy <arg>         Coverage report output strategy. One\r\n                                        of [PER_TEST, TOTAL, BOTH]\r\n     -t,--thread-count <arg>            The maximum number of threads to use\r\n                                        (defaults to the number of cores)\r\n                                        \r\nA pre-built package containing the executable jar with dependencies can be downloaded from [here](http://code.google.com/p/saga-javascript-coverage/downloads/list).\r\n\r\nWhy the name?\r\n=============\r\n\r\nWhy not? Actually, it was suggested by my girlfriend after she started reading a book on Viking history. Plus,\r\n[Maven Central search](http://search.maven.org) only finds this project's artifacts, so there's no ambiguity.\r\n\r\nWhy doesn't my Internet Explorer show the report as nicely as it is on the screenshot above?\r\n============================================================================================\r\n\r\nIf you're looking at a JS code coverage report with IE, then I'll [put it gently](http://www.stopusingie.com/) and\r\nnot start calling you names, even though I should. In short, Saga will never support IE-compatible reports. No graceful\r\ndegradation, no nothing. Reports may work or they may not - if they do, it's purely coincidental and I cannot be held\r\nresponsible for it.\r\n","tagline":"Better code coverage tool for JavaScript","google":"UA-31382741-1","note":"Don't delete this file! It's used internally to help with page regeneration."}